PROJECT=scaler-attempt
BUCKET=$PROJECT-bucket


printf "******************************************************************************** \n"
printf "Enabling services in your GCP project \n"
gcloud services enable cloudbuild.googleapis.com || true
gcloud services enable storage.googleapis.com || true
gcloud services enable cloudfunctions.googleapis.com || true
printf "Enabling services in your GCP project - done \n"

gsutil mb gs://$BUCKET


gcloud functions deploy scaler --runtime go116 \
	--trigger-resource $BUCKET --trigger-event google.storage.object.finalize \
	--entry-point OnFileUpload --source code/function